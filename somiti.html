<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cooperative Financial System 2026</title>
    <!-- Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #0f172a; /* Navy */
            --secondary: #3b82f6; /* Blue */
            --accent: #10b981; /* Green */
            --danger: #ef4444; /* Red */
            --bg: #f1f5f9;
            --card-bg: #ffffff;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        
        body { background-color: var(--bg); color: var(--text-main); height: 100vh; display: flex; overflow: hidden; }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background-color: var(--primary);
            color: white;
            display: flex;
            flex-direction: column;
            transition: 0.3s;
        }
        .logo {
            padding: 24px;
            font-size: 1.2rem;
            font-weight: 700;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .nav-links { list-style: none; padding: 20px 0; flex: 1; }
        .nav-item {
            padding: 12px 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #94a3b8;
            transition: 0.2s;
            text-decoration: none;
        }
        .nav-item:hover, .nav-item.active { background: rgba(255,255,255,0.05); color: white; border-left: 4px solid var(--secondary); }
        
        /* Main Content */
        .main-content { flex: 1; overflow-y: auto; display: flex; flex-direction: column; }
        
        /* Header */
        header {
            background: var(--card-bg);
            padding: 16px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
            position: sticky; top: 0; z-index: 10;
        }
        .date-badge { background: var(--bg); padding: 6px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 500; }

        /* Views */
        .view-section { display: none; padding: 32px; animation: fadeIn 0.3s ease; }
        .view-section.active { display: block; }

        /* Dashboard Cards */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 24px; margin-bottom: 32px; }
        .stat-card {
            background: var(--card-bg);
            padding: 24px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }
        .stat-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px; }
        .stat-icon { width: 40px; height: 40px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }
        .bg-blue { background: #dbeafe; color: var(--secondary); }
        .bg-green { background: #d1fae5; color: var(--accent); }
        .bg-red { background: #fee2e2; color: var(--danger); }
        .bg-purple { background: #f3e8ff; color: #9333ea; }

        .stat-value { font-size: 1.8rem; font-weight: 700; color: var(--text-main); }
        .stat-label { font-size: 0.9rem; color: var(--text-muted); margin-top: 4px; }

        /* Tables */
        .table-container { background: var(--card-bg); border-radius: 12px; box-shadow: var(--shadow); overflow: hidden; border: 1px solid var(--border); }
        .table-header { padding: 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 16px 20px; text-align: left; border-bottom: 1px solid var(--border); }
        th { background: #f8fafc; font-weight: 600; color: var(--text-muted); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.5px; }
        tr:last-child td { border-bottom: none; }
        tr:hover { background: #f8fafc; }
        
        /* Buttons */
        .btn { padding: 8px 16px; border-radius: 6px; border: none; cursor: pointer; font-weight: 500; font-size: 0.9rem; transition: 0.2s; display: inline-flex; align-items: center; gap: 8px; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: #1e293b; }
        .btn-secondary { background: white; border: 1px solid var(--border); color: var(--text-main); }
        .btn-sm { padding: 6px 12px; font-size: 0.8rem; }
        .btn-danger { background: #fee2e2; color: var(--danger); }

        /* Modal */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 100; justify-content: center; align-items: center;
        }
        .modal-content { background: white; width: 100%; max-width: 500px; border-radius: 12px; padding: 24px; animation: slideUp 0.3s ease; }
        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; font-size: 0.9rem; }
        .form-group input, .form-group select { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; outline: none; }
        .form-group input:focus { border-color: var(--secondary); }
        
        .status-pill { padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; }
        .status-active { background: #d1fae5; color: var(--accent); }
        .status-due { background: #fee2e2; color: var(--danger); }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar { position: fixed; left: -260px; height: 100%; z-index: 50; }
            .sidebar.open { left: 0; }
            .mobile-menu { display: block; }
            .stats-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
        <div class="logo">
            <i class="fa-solid fa-layer-group"></i> CoopManager 2026
        </div>
        <ul class="nav-links">
            <li class="nav-item active" onclick="navigate('dashboard')">
                <i class="fa-solid fa-chart-pie"></i> Dashboard
            </li>
            <li class="nav-item" onclick="navigate('members')">
                <i class="fa-solid fa-users"></i> Members
            </li>
            <li class="nav-item" onclick="navigate('loans')">
                <i class="fa-solid fa-hand-holding-dollar"></i> Loans
            </li>
            <li class="nav-item" onclick="navigate('accounting')">
                <i class="fa-solid fa-receipt"></i> Accounting
            </li>
            <li class="nav-item" onclick="resetSystem()" style="margin-top: auto; color: #ef4444;">
                <i class="fa-solid fa-power-off"></i> Reset System
            </li>
        </ul>
    </nav>

    <div class="main-content">
        <header>
            <button class="btn btn-secondary mobile-menu" onclick="toggleSidebar()" style="display:none;"><i class="fa-solid fa-bars"></i></button>
            <h2 id="page-title">Dashboard</h2>
            <div class="date-badge" id="current-date">January 20, 2026</div>
        </header>

        <!-- DASHBOARD VIEW -->
        <div id="dashboard" class="view-section active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <div>
                            <div class="stat-value" id="dash-balance">৳0</div>
                            <div class="stat-label">Cash In Hand (Net)</div>
                        </div>
                        <div class="stat-icon bg-blue"><i class="fa-solid fa-wallet"></i></div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div>
                            <div class="stat-value" id="dash-deposit">৳0</div>
                            <div class="stat-label">Total Deposits</div>
                        </div>
                        <div class="stat-icon bg-purple"><i class="fa-solid fa-piggy-bank"></i></div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div>
                            <div class="stat-value" id="dash-loan">৳0</div>
                            <div class="stat-label">Active Loans (Out)</div>
                        </div>
                        <div class="stat-icon bg-red"><i class="fa-solid fa-money-bill-transfer"></i></div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div>
                            <div class="stat-value" id="dash-profit">৳0</div>
                            <div class="stat-label">Net Profit</div>
                        </div>
                        <div class="stat-icon bg-green"><i class="fa-solid fa-arrow-trend-up"></i></div>
                    </div>
                </div>
            </div>

            <div class="table-container">
                <div class="table-header">
                    <h3>Financial Snapshot</h3>
                </div>
                <table id="summary-table">
                    <tr>
                        <td>Total Active Members</td>
                        <td id="dash-members">0</td>
                    </tr>
                    <tr>
                        <td>Profit Per Member</td>
                        <td id="dash-ppm">৳0</td>
                    </tr>
                    <tr>
                        <td>Total Due (Unpaid by Members)</td>
                        <td id="dash-due" style="color: var(--danger);">৳0</td>
                    </tr>
                    <tr>
                        <td>Total Expenses</td>
                        <td id="dash-expense">৳0</td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- MEMBERS VIEW -->
        <div id="members" class="view-section">
            <div class="table-container">
                <div class="table-header">
                    <h3>Member Directory</h3>
                    <button class="btn btn-primary btn-sm" onclick="openModal('memberModal')"><i class="fa-solid fa-plus"></i> Add Member</button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Total Deposit</th>
                            <th>Due Amount</th>
                            <th>Est. Share</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="members-table-body">
                        <!-- JS renders here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- LOANS VIEW -->
        <div id="loans" class="view-section">
            <div class="table-container">
                <div class="table-header">
                    <h3>Active Loans</h3>
                    <button class="btn btn-primary btn-sm" onclick="openModal('loanModal')"><i class="fa-solid fa-plus"></i> Issue New Loan</button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Borrower</th>
                            <th>Amount</th>
                            <th>Issue Date</th>
                            <th>Deadline</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="loans-table-body">
                        <!-- JS renders here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ACCOUNTING VIEW -->
        <div id="accounting" class="view-section">
            <div class="table-container">
                <div class="table-header">
                    <h3>Transaction History (Profit/Exp)</h3>
                    <div>
                        <button class="btn btn-secondary btn-sm" onclick="openModal('expenseModal')">Add Expense</button>
                        <button class="btn btn-primary btn-sm" onclick="openModal('incomeModal')">Add Income</button>
                    </div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Type</th>
                            <th>Description</th>
                            <th>Amount</th>
                        </tr>
                    </thead>
                    <tbody id="trans-table-body">
                        <!-- JS renders here -->
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <!-- MODALS -->

    <!-- Edit Member Modal -->
    <div id="editMemberModal" class="modal">
        <div class="modal-content">
            <h3>Edit Member</h3>
            <div class="form-group">
                <label>Deposit Amount (Add/Subtract)</label>
                <input type="number" id="edit-deposit" placeholder="Current Deposit">
            </div>
            <div class="form-group">
                <label>Due Amount (Negative means they owe)</label>
                <input type="number" id="edit-due" placeholder="-6000">
            </div>
            <input type="hidden" id="edit-id">
            <div style="text-align: right;">
                <button class="btn btn-secondary" onclick="closeModal('editMemberModal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveMemberEdit()">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Add Loan Modal -->
    <div id="loanModal" class="modal">
        <div class="modal-content">
            <h3>Issue New Loan</h3>
            <div class="form-group">
                <label>Borrower Name (Member or External)</label>
                <input type="text" id="loan-name">
            </div>
            <div class="form-group">
                <label>Amount</label>
                <input type="number" id="loan-amount">
            </div>
            <div class="form-group">
                <label>Deadline Date</label>
                <input type="date" id="loan-deadline">
            </div>
            <div style="text-align: right;">
                <button class="btn btn-secondary" onclick="closeModal('loanModal')">Cancel</button>
                <button class="btn btn-primary" onclick="addLoan()">Issue Loan</button>
            </div>
        </div>
    </div>

    <!-- Income Modal -->
    <div id="incomeModal" class="modal">
        <div class="modal-content">
            <h3>Record Income (Profit)</h3>
            <div class="form-group">
                <label>Amount</label>
                <input type="number" id="inc-amount">
            </div>
            <div class="form-group">
                <label>Source / Description</label>
                <input type="text" id="inc-desc" placeholder="e.g. Loan Interest">
            </div>
            <div class="form-group">
                <label>Month</label>
                <select id="inc-month">
                    <option>January</option><option>February</option><option>March</option>
                </select>
            </div>
            <div style="text-align: right;">
                <button class="btn btn-secondary" onclick="closeModal('incomeModal')">Cancel</button>
                <button class="btn btn-primary" onclick="addTransaction('income')">Save</button>
            </div>
        </div>
    </div>

    <!-- Expense Modal -->
    <div id="expenseModal" class="modal">
        <div class="modal-content">
            <h3>Record Expense</h3>
            <div class="form-group">
                <label>Amount</label>
                <input type="number" id="exp-amount">
            </div>
            <div class="form-group">
                <label>Description</label>
                <input type="text" id="exp-desc">
            </div>
            <div style="text-align: right;">
                <button class="btn btn-secondary" onclick="closeModal('expenseModal')">Cancel</button>
                <button class="btn btn-danger" onclick="addTransaction('expense')">Save Expense</button>
            </div>
        </div>
    </div>

    <script>
        // --- DATA INITIALIZATION BASED ON CSV ---
        const DEFAULT_DATA = {
            members: [
                { id: 1, name: "MIZAN 1", deposit: 17000, due: -6000 },
                { id: 2, name: "MIZAN 2", deposit: 17000, due: -6000 },
                { id: 3, name: "BAPPI", deposit: 16000, due: -6000 },
                { id: 4, name: "RAHIM 1", deposit: 26000, due: -6000, phone: "01788378146", ac: "FD0002" },
                { id: 5, name: "RAHIM 2", deposit: 26000, due: -6000 },
                { id: 6, name: "RAKIB 1", deposit: 29000, due: -6000 },
                { id: 7, name: "RAKIB 2", deposit: 29000, due: -6000 },
                { id: 8, name: "JUWEL", deposit: 27000, due: -6000 },
                { id: 9, name: "AKHTER", deposit: 21000, due: -6000 },
                { id: 10, name: "ANOWAR", deposit: 23000, due: -6000 },
                { id: 11, name: "ZIKU", deposit: 29000, due: -6000 }
            ],
            // 138k Total Loan in Summary, but history was empty. I will create a placeholder.
            loans: [
                { id: 1, name: "General Fund Loan", amount: 138000, date: "2026-01-01", deadline: "2026-06-30" }
            ],
            // 15k Profit, 100 Expense
            transactions: [
                { id: 1, type: "income", amount: 12000, desc: "January Profit", date: "2026-01-15" },
                { id: 2, type: "income", amount: 2000, desc: "February Advance Profit", date: "2026-01-20" },
                { id: 3, type: "expense", amount: 100, desc: "Stationery/Misc", date: "2026-01-05" }
            ]
        };

        // --- STATE MANAGEMENT ---
        let appData = JSON.parse(localStorage.getItem('coopData')) || DEFAULT_DATA;

        function saveData() {
            localStorage.setItem('coopData', JSON.stringify(appData));
            renderAll();
        }

        function resetSystem() {
            if(confirm("Are you sure? This will delete all changes and revert to the CSV default.")) {
                localStorage.removeItem('coopData');
                location.reload();
            }
        }

        // --- FORMATTING HELPERS ---
        const formatMoney = (amount) => '৳' + Number(amount).toLocaleString('en-BD');
        
        // --- RENDER FUNCTIONS ---
        function renderAll() {
            renderDashboard();
            renderMembers();
            renderLoans();
            renderTransactions();
        }

        function renderDashboard() {
            // Calculations
            const totalDeposit = appData.members.reduce((sum, m) => sum + Number(m.deposit), 0);
            const totalDue = appData.members.reduce((sum, m) => sum + Number(m.due), 0);
            const totalLoan = appData.loans.reduce((sum, l) => sum + Number(l.amount), 0);
            
            const totalIncome = appData.transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + Number(t.amount), 0);
            const totalExpense = appData.transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + Number(t.amount), 0);
            const netProfit = totalIncome - totalExpense;
            
            // Logic: Cash = Deposit + NetProfit - LoansOut
            const cashInHand = totalDeposit + netProfit - totalLoan;
            const profitPerMember = netProfit / appData.members.length;

            // DOM Updates
            document.getElementById('dash-balance').innerText = formatMoney(cashInHand);
            document.getElementById('dash-deposit').innerText = formatMoney(totalDeposit);
            document.getElementById('dash-loan').innerText = formatMoney(totalLoan);
            document.getElementById('dash-profit').innerText = formatMoney(netProfit);
            
            document.getElementById('dash-members').innerText = appData.members.length;
            document.getElementById('dash-ppm').innerText = formatMoney(profitPerMember.toFixed(2));
            document.getElementById('dash-due').innerText = formatMoney(totalDue);
            document.getElementById('dash-expense').innerText = formatMoney(totalExpense);
        }

        function renderMembers() {
            const tbody = document.getElementById('members-table-body');
            tbody.innerHTML = '';
            
            // Calculate Profit Share for display
            const totalIncome = appData.transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + Number(t.amount), 0);
            const totalExpense = appData.transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + Number(t.amount), 0);
            const ppm = (totalIncome - totalExpense) / appData.members.length;

            appData.members.forEach(member => {
                const totalShare = Number(member.deposit) + ppm + Number(member.due);
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>
                        <div style="font-weight:600">${member.name}</div>
                        <div style="font-size:0.8rem; color:#64748b">${member.ac || 'No A/C'}</div>
                    </td>
                    <td>${formatMoney(member.deposit)}</td>
                    <td style="color:${member.due < 0 ? 'var(--danger)' : 'var(--accent)'}">${formatMoney(member.due)}</td>
                    <td>${formatMoney(totalShare.toFixed(0))}</td>
                    <td>
                        <button class="btn btn-secondary btn-sm" onclick="editMember(${member.id})"><i class="fa-solid fa-pen"></i></button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function renderLoans() {
            const tbody = document.getElementById('loans-table-body');
            tbody.innerHTML = '';
            appData.loans.forEach((loan, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${loan.name}</td>
                    <td>${formatMoney(loan.amount)}</td>
                    <td>${loan.date}</td>
                    <td>${loan.deadline || 'N/A'}</td>
                    <td>
                        <button class="btn btn-secondary btn-sm" style="color:var(--accent)" onclick="repayLoan(${index})">Repay</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function renderTransactions() {
            const tbody = document.getElementById('trans-table-body');
            tbody.innerHTML = '';
            // Show recent last
            [...appData.transactions].reverse().forEach(t => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${t.date}</td>
                    <td><span class="status-pill ${t.type === 'income' ? 'status-active' : 'status-due'}">${t.type.toUpperCase()}</span></td>
                    <td>${t.desc}</td>
                    <td>${formatMoney(t.amount)}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // --- ACTIONS ---

        // Edit Member
        function editMember(id) {
            const member = appData.members.find(m => m.id === id);
            if(!member) return;
            document.getElementById('edit-id').value = id;
            document.getElementById('edit-deposit').value = member.deposit;
            document.getElementById('edit-due').value = member.due;
            openModal('editMemberModal');
        }

        function saveMemberEdit() {
            const id = Number(document.getElementById('edit-id').value);
            const deposit = Number(document.getElementById('edit-deposit').value);
            const due = Number(document.getElementById('edit-due').value);
            
            const memberIndex = appData.members.findIndex(m => m.id === id);
            if(memberIndex > -1) {
                appData.members[memberIndex].deposit = deposit;
                appData.members[memberIndex].due = due;
                saveData();
                closeModal('editMemberModal');
            }
        }

        // Loans
        function addLoan() {
            const name = document.getElementById('loan-name').value;
            const amount = Number(document.getElementById('loan-amount').value);
            const date = new Date().toISOString().split('T')[0];
            const deadline = document.getElementById('loan-deadline').value;

            if(name && amount > 0) {
                appData.loans.push({ name, amount, date, deadline });
                saveData();
                closeModal('loanModal');
            }
        }

        function repayLoan(index) {
            if(confirm("Mark this loan as returned/repaid? Funds will return to Balance.")) {
                appData.loans.splice(index, 1);
                saveData();
            }
        }

        // Transactions
        function addTransaction(type) {
            const prefix = type === 'income' ? 'inc' : 'exp';
            const amount = Number(document.getElementById(prefix+'-amount').value);
            const desc = document.getElementById(prefix+'-desc').value;
            const date = new Date().toISOString().split('T')[0];

            if(amount > 0) {
                appData.transactions.push({ type, amount, desc, date });
                // If it's pure income (profit), the system balance increases naturally in render calc.
                saveData();
                closeModal(type+'Modal');
            }
        }

        // --- UI NAVIGATION ---
        function navigate(viewId) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            
            document.getElementById(viewId).classList.add('active');
            
            // Highlight nav
            const navIndex = ['dashboard', 'members', 'loans', 'accounting'].indexOf(viewId);
            document.querySelectorAll('.nav-item')[navIndex].classList.add('active');
            
            // Update Title
            document.getElementById('page-title').innerText = viewId.charAt(0).toUpperCase() + viewId.slice(1);
            
            // Mobile close sidebar
            if(window.innerWidth < 768) {
                document.getElementById('sidebar').classList.remove('open');
            }
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }

        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }

        // Close modal on outside click
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = "none";
            }
        }

        // --- INIT ---
        renderAll();
        
        // Dynamic Date
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        document.getElementById('current-date').innerText = new Date().toLocaleDateString("en-US", options);

    </script>
</body>
</html>